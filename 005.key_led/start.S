
.text
.global _start

_start:
	

	/* 设置协处理器 把外设的基地址和内存大小告诉CPU*/
	ldr r0, =0x70000000   //对于6410来说,内存(0x00000000～0x60000000),外设(0x70000000-0x7fffffff)
	orr r0, r0, #0x13	 //把r0的第4，1，0位置1即0x70000013，再送回r0； 外设大小:256M
	mcr p15,0,r0,c15,c2,4  //把r0的值(包括了外设基地址+外设大小)写入协处理器
	
	/* 关闭看门狗*/
	ldr r0, =0x7E004000
	mov r1, #0
	str r1, [r0]
	
	/* 判断是nand启动还是nor启动，同时设置内存：sp栈 */
	mov r1, #0
	ldr r0, [r1] //备份r0的值
	str r1, [r1]	//把0存到0地址空间
	ldr r2, [r1] //把0地址空间值读到r2寄存器里
	cmp r1, r2   //比较r1，r2寄存里的值
	ldr sp, =0x40000000+4096 //假设是nor启动，此时sp为soc2440的堆栈地址
	moveq sp, #4096 //比较值相等的话就是nand启动，sp=4086
	streq r0,[r1] //恢复原来0地址的值

	//ldr sp,=0x40000000+4096 /* nor启动 */

	/* 调用main函数 */
	bl main

halt:
    b halt
		
.end
	
	
